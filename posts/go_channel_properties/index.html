<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Properties of Go Channels - Benson Li&#39;s Blog</title>
  <meta name="description" content="1Consequences of Blocking Synchronization:  1.1Making Channels Non-Blocking &#43; Select   2Consequences of Consumption:  2.1Cannot be easily used as a broadcast mechanism 2.2How about the inverse case?   3Example of when we would want to Consume &#43; Block: Streams: 4Channels Often Come with a Level of Indirection:  4.1Tee Channel 4.2Consequence of Indirection   5Final Remarks  This blog post is a summary of an investigation I did regarding channel vs mutex usage, as most resources I found would just present examples side by side without talking about the properties of mutexes/channels that made one implementation better than other(Or in other words, the why).">
  <meta name="author" content="Benson Li"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Benson Li\u0027s Blog",
    
    "url": "https:\/\/bbli.github.io"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/bbli.github.io"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/bbli.github.io",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/bbli.github.io\/posts\/go_channel_properties\/",
          "name": "Properties of go channels"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Benson Li"
  },
  "headline": "Properties of Go Channels",
  "description" : "1Consequences of Blocking Synchronization:  1.1Making Channels Non-Blocking \u002b Select   2Consequences of Consumption:  2.1Cannot be easily used as a broadcast mechanism 2.2How about the inverse case?   3Example of when we would want to Consume \u002b Block: Streams: 4Channels Often Come with a Level of Indirection:  4.1Tee Channel 4.2Consequence of Indirection   5Final Remarks  This blog post is a summary of an investigation I did regarding channel vs mutex usage, as most resources I found would just present examples side by side without talking about the properties of mutexes\/channels that made one implementation better than other(Or in other words, the why).",
  "inLanguage" : "en",
  "wordCount":  2280 ,
  "datePublished" : "2021-05-31T00:00:00",
  "dateModified" : "2021-05-31T00:00:00",
  "image" : "https:\/\/bbli.github.io\/img\/avatar-icon.png",
  "keywords" : [ "go, software-design" ],
  "mainEntityOfPage" : "https:\/\/bbli.github.io\/posts\/go_channel_properties\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/bbli.github.io",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/bbli.github.io\/img\/avatar-icon.png",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="Properties of Go Channels" />
<meta property="og:description" content="1Consequences of Blocking Synchronization:  1.1Making Channels Non-Blocking &#43; Select   2Consequences of Consumption:  2.1Cannot be easily used as a broadcast mechanism 2.2How about the inverse case?   3Example of when we would want to Consume &#43; Block: Streams: 4Channels Often Come with a Level of Indirection:  4.1Tee Channel 4.2Consequence of Indirection   5Final Remarks  This blog post is a summary of an investigation I did regarding channel vs mutex usage, as most resources I found would just present examples side by side without talking about the properties of mutexes/channels that made one implementation better than other(Or in other words, the why).">
<meta property="og:image" content="https://bbli.github.io/img/avatar-icon.png" />
<meta property="og:url" content="https://bbli.github.io/posts/go_channel_properties/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Benson Li&#39;s Blog" />

  <meta name="twitter:title" content="Properties of Go Channels" />
  <meta name="twitter:description" content="1Consequences of Blocking Synchronization:  1.1Making Channels Non-Blocking &#43; Select   2Consequences of Consumption:  2.1Cannot be easily used as a broadcast mechanism 2.2How about the inverse case? â€¦">
  <meta name="twitter:image" content="https://bbli.github.io/img/avatar-icon.png" />
  <meta name="twitter:card" content="summary" />
  <link href='https://bbli.github.io/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.86.0" />
  <link rel="alternate" href="https://bbli.github.io/index.xml" type="application/rss+xml" title="Benson Li&#39;s Blog"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://bbli.github.io/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="https://bbli.github.io/css/syntax.css" /><link rel="stylesheet" href="https://bbli.github.io/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">



  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://bbli.github.io">Benson Li&#39;s Blog</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blog" href="/">Blog</a>
            </li>
          
        
          
            <li>
              <a title="About" href="/about">About</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="/tags">Tags</a>
            </li>
          
        

        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="Benson Li&#39;s Blog" href="https://bbli.github.io">
            <img class="avatar-img" src="https://bbli.github.io/img/avatar-icon.png" alt="Benson Li&#39;s Blog" />
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="posts-heading">
              
                <h1>Properties of Go Channels</h1>
              
              
                <hr class="small">
              
              
              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
    <p class="post-meta">
        <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;Posted on May 31, 2021
  
  
    &nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;11&nbsp;minutes
  
  
    &nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;2280&nbsp;words
  
  
  
</span>


    </p>
        
          <div class="blog-tags">
            
              <a href="https://bbli.github.io/tags/go/">go</a>&nbsp;
            
              <a href="https://bbli.github.io/tags/software-design/">software-design</a>&nbsp;
            
          </div>
        

        <!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<ul>
<li><!-- raw HTML omitted -->1<!-- raw HTML omitted --> <a href="#consequences-of-blocking-synchronization">Consequences of Blocking Synchronization:</a>
<ul>
<li><!-- raw HTML omitted -->1.1<!-- raw HTML omitted --> <a href="#making-channels-non-blocking-plus-select">Making Channels Non-Blocking + Select</a></li>
</ul>
</li>
<li><!-- raw HTML omitted -->2<!-- raw HTML omitted --> <a href="#consequences-of-consumption">Consequences of Consumption:</a>
<ul>
<li><!-- raw HTML omitted -->2.1<!-- raw HTML omitted --> <a href="#cannot-be-easily-used-as-a-broadcast-mechanism">Cannot be easily used as a broadcast mechanism</a></li>
<li><!-- raw HTML omitted -->2.2<!-- raw HTML omitted --> <a href="#how-about-the-inverse-case">How about the inverse case?</a></li>
</ul>
</li>
<li><!-- raw HTML omitted -->3<!-- raw HTML omitted --> <a href="#example-of-when-we-would-want-to-consume-plus-block-streams">Example of when we would want to Consume + Block: Streams:</a></li>
<li><!-- raw HTML omitted -->4<!-- raw HTML omitted --> <a href="#channels-often-come-with-a-level-of-indirection">Channels Often Come with a Level of Indirection:</a>
<ul>
<li><!-- raw HTML omitted -->4.1<!-- raw HTML omitted --> <a href="#tee-channel">Tee Channel</a></li>
<li><!-- raw HTML omitted -->4.2<!-- raw HTML omitted --> <a href="#consequence-of-indirection">Consequence of Indirection</a></li>
</ul>
</li>
<li><!-- raw HTML omitted -->5<!-- raw HTML omitted --> <a href="#final-remarks">Final Remarks</a></li>
</ul>
<!-- raw HTML omitted -->
<p>This blog post is a summary of an investigation I did regarding channel vs mutex usage, as most resources I found would just present examples side by side without talking about the properties of mutexes/channels that made one implementation better than other(Or in other words, the why).</p>
<h1 id="consequences-of-blocking-synchronization"><!-- raw HTML omitted -->1<!-- raw HTML omitted --> Consequences of Blocking Synchronization:</h1>
<p>Channels implement what <a href="https://greenteapress.com/wp/semaphores/">The Little Book of Semaphores</a> calls &ldquo;the leader follower pattern&rdquo;. If the receiver is not ready, the sender will block and vice versa. This can cause <a href="https://stackoverflow.com/questions/54157836/a-simple-example-about-go-channel-with-deadlock-and-why/54157914">troubles with beginners</a> in Go, as &ldquo;deadlocks&rdquo;<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> can happen in a single threaded context. Furthermore, if you would like one goroutine to signal to another via a Channel, it will necessary block until a receiver is ready. There may be times, however, where you want to do more work afterwards. However, there are methods to work around this, as we shall discuss now.</p>
<h2 id="making-channels-non-blocking-plus-select"><!-- raw HTML omitted -->1.1<!-- raw HTML omitted --> Making Channels Non-Blocking + Select</h2>
<p>One way to achieve non blocking channels is to create your channels with a &ldquo;buffer size&rdquo;(i.e <code>make(chan string,2)</code>). I am not a fan of this, as it breaks my ability to reason locally about code. This is because with a buffered channel, I cannot reason about whether the code in front of me will block or not, as that is dependent on the state of  the buffer, which can only be known at runtime. As jerf puts it in this <a href="https://news.ycombinator.com/item?id=16149856">Hacker News post</a>, buffered channels should mostly be used as a response to your traffic/backpressure, and not as an initial design decision.</p>
<p>Another way would be to combine channels with the <code>select</code> statement. This runs the risk of not sending the message if we break out somewhere else in the for loop. Nevertheless, the <code>select</code> statement is still very powerful as <strong>by polling for the first response, it allows us to vary the degree to which we are blocking</strong>, from one channel to multiple channels to timeout and all the way to &ldquo;never&rdquo;, as shown below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="k">for</span> <span class="p">{</span>
    <span class="k">select</span><span class="p">{</span><span class="k">case</span> <span class="o">&lt;-</span><span class="nx">our_channel</span><span class="p">:</span> <span class="k">break</span><span class="p">;</span> <span class="k">default</span><span class="p">:}</span>

    <span class="c1">// do stuff until there is a receiver for our_channel
</span><span class="c1"></span><span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p>Lastly, use another level of indirection, aka</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// Instead of
</span><span class="c1"></span><span class="nx">ch</span><span class="o">&lt;-</span><span class="s">&#34;finished&#34;</span>
<span class="c1">// do this
</span><span class="c1"></span><span class="k">go</span> <span class="nf">fun</span><span class="p">(){</span><span class="nx">ch</span><span class="o">&lt;-</span><span class="s">&#34;finished&#34;</span><span class="p">}()</span></code></pre></td></tr></table>
</div>
</div>
<p>Downside is that if no one receives, we will have a memory leak/the unbounded lifetime perhaps can cause some bugs down the road</p>
<h1 id="consequences-of-consumption"><!-- raw HTML omitted -->2<!-- raw HTML omitted --> Consequences of Consumption:</h1>
<h2 id="cannot-be-easily-used-as-a-broadcast-mechanism"><!-- raw HTML omitted -->2.1<!-- raw HTML omitted --> Cannot be easily used as a broadcast mechanism</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// notifier goroutine
</span><span class="c1"></span><span class="k">go</span> <span class="kd">func</span><span class="p">(){</span>
    <span class="nf">do_some_work</span><span class="p">()</span>
    <span class="nx">work_done</span><span class="o">&lt;-</span> <span class="kd">struct</span><span class="p">{}</span>
<span class="p">}()</span>

<span class="c1">// waiting goroutine 1
</span><span class="c1"></span><span class="k">go</span> <span class="kd">func</span><span class="p">(){</span>
    <span class="o">&lt;-</span><span class="nx">work_done</span>
    <span class="nf">do_other_stuff_1</span><span class="p">()</span>
<span class="p">}()</span>
<span class="c1">// waiting goroutine 2- one of these will receive the signal
</span><span class="c1"></span><span class="k">go</span> <span class="kd">func</span><span class="p">(){</span>
    <span class="o">&lt;-</span><span class="nx">work_done</span>
    <span class="nf">do_other_stuff_2</span><span class="p">()</span>
<span class="p">}()</span></code></pre></td></tr></table>
</div>
</div>
<p>As the above code shows, although we can copy a channel so that multiple readers can listen to it, the sender will only send once and its value will be consumed by only one waiting goroutine. Now, one way to broadcast would be for the sender to hold a send channel for each of its notifiees. This has the disadvantage that the system is either &ldquo;closed&rdquo; to future participants, or we would need additional synchronization on a list data structure.</p>
<p>Thus, unless you know who want to notify up front, a condition variable will probably give you better flexibility.</p>
<h2 id="how-about-the-inverse-case"><!-- raw HTML omitted -->2.2<!-- raw HTML omitted --> How about the inverse case?</h2>
<p>Instead, suppose now that we are the notifiee, and do not know ahead of time who may notify us. In such a case, channels do work here, because <strong>we only need to be notified/consumed once</strong>. For example,</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">event</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kd">struct</span><span class="p">{},</span><span class="mi">0</span><span class="p">)</span>
<span class="c1">// notifier goroutine
</span><span class="c1"></span><span class="k">go</span> <span class="kd">func</span><span class="p">(){</span>
    <span class="o">&lt;-</span><span class="nx">event</span>
    <span class="nx">do_something</span>
<span class="p">}()</span>

<span class="c1">// anybody in the future
</span><span class="c1"></span><span class="k">go</span> <span class="kd">func</span><span class="p">(){</span>
    <span class="nf">do_random_stuff_for_x_seconds</span><span class="p">()</span>
    <span class="nx">event</span><span class="o">&lt;-</span> <span class="kd">struct</span><span class="p">{}</span>
<span class="p">}()</span>

<span class="k">go</span> <span class="kd">func</span><span class="p">(){</span>
    <span class="nf">do_random_stuff_for_y_seconds</span><span class="p">()</span>
    <span class="nx">event</span><span class="o">&lt;-</span><span class="kd">struct</span><span class="p">{}</span>
<span class="p">}()</span>
<span class="nx">etc</span><span class="o">...</span></code></pre></td></tr></table>
</div>
</div>
<p>(Though one may want to add an additional <code>select</code> statement along with a timeout so the goroutines don&rsquo;t leak)</p>
<h1 id="example-of-when-we-would-want-to-consume-plus-block-streams"><!-- raw HTML omitted -->3<!-- raw HTML omitted --> Example of when we would want to Consume + Block: Streams:</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">sq</span><span class="p">(</span><span class="nx">in</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="nx">out</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">for</span> <span class="nx">n</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">in</span> <span class="p">{</span>
            <span class="nx">out</span> <span class="o">&lt;-</span> <span class="nx">n</span> <span class="o">*</span> <span class="nx">n</span>
        <span class="p">}</span>
        <span class="nb">close</span><span class="p">(</span><span class="nx">out</span><span class="p">)</span>
    <span class="p">}()</span>
    <span class="k">return</span> <span class="nx">out</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p>vs Mutex</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">sq</span><span class="p">(</span><span class="nx">in_loc</span> <span class="o">*</span><span class="kt">int</span><span class="p">,</span><span class="nx">in_p</span> <span class="o">*</span><span class="nx">Semaphore</span><span class="p">,</span> <span class="nx">in_w</span> <span class="o">*</span><span class="nx">Semaphore</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">Semaphore</span><span class="p">,</span><span class="o">*</span><span class="kt">int</span><span class="p">){</span>
    <span class="nx">sq_out</span><span class="o">:=</span> <span class="o">&amp;</span><span class="kt">int</span>
    <span class="nx">sq_p</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Semaphore</span><span class="p">{}</span>
    <span class="nx">sq_w</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Semaphore</span><span class="p">{}</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">(){</span>
        <span class="k">for</span> <span class="p">{</span><span class="c1">// infinite loop so I don&#39;t want to create another variable+synchronization for communication
</span><span class="c1"></span>            <span class="nx">in_p</span><span class="p">.</span><span class="nf">wait</span><span class="p">()</span> <span class="c1">// wait for previous thread to produce the input
</span><span class="c1"></span>            <span class="kd">var</span> <span class="nx">local</span> <span class="p">=</span> <span class="o">*</span><span class="nx">in_loc</span> <span class="c1">// read from memory the location the previous thread wrote to
</span><span class="c1"></span>            <span class="nx">in_w</span><span class="p">.</span><span class="nf">signal</span><span class="p">()</span> <span class="c1">// tell previous thread it can start working again
</span><span class="c1"></span>            <span class="o">*</span><span class="nx">transformed</span> <span class="p">=</span> <span class="nx">local</span><span class="o">*</span><span class="nx">local</span>
            <span class="nx">sq_p</span><span class="p">.</span><span class="nf">signal</span><span class="p">()</span>
			<span class="nx">sq_w</span><span class="p">.</span><span class="nf">wait</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">sq_out</span><span class="p">,</span><span class="nx">sq_p</span><span class="p">,</span><span class="nx">sq_w</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p>As we can see, channels encapsulate a lot of things! Namely:</p>
<ul>
<li>Termination of source(via <code>close(channel</code>) -&gt; which will propagate to downstream goroutines</li>
<li>location of result/abstracting away consumption behavior</li>
<li>synchronization of threads</li>
</ul>
<p>The reason we want blocking here is because otherwise, the sequence cannot be lazily generated. Additionally, channels allow us to not have raw pointers and semaphores floating around in our codebase, which is a huge gain in writing correct code. Another thing that I would like to note is that because the mutex is not inside a class, its guarantee is only &ldquo;opt in&rdquo;. Namely, the mutex code runs the danger of someone not blocking on <code>sq_p</code> and just reading from <code>sq_out</code> directly. With a channel, this cannot happen. Furthermore, one can specify only read/write &ldquo;facade&rdquo;(by making the return type of the channel <code>&lt;-ch</code> or <code>ch&lt;-</code>) of the channel, whereas with a mutex, one technically has both read and write access to the underlying resource</p>
<h1 id="channels-often-come-with-a-level-of-indirection"><!-- raw HTML omitted -->4<!-- raw HTML omitted --> Channels Often Come with a Level of Indirection:</h1>
<h2 id="tee-channel"><!-- raw HTML omitted -->4.1<!-- raw HTML omitted --> Tee Channel</h2>
<p>(Note: This example was more or less taken from &ldquo;Concurrency in Go&rdquo; by  Katherine Cox-Buday, except for simplicity I removed the code to handle the goroutine leak)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">tee</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">in</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="kd">interface</span><span class="p">{},)</span> <span class="p">(</span><span class="o">&lt;-</span><span class="kd">chan</span> <span class="kd">interface</span><span class="p">{},</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
    <span class="nx">out1</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kd">interface</span><span class="p">{})</span>
    <span class="nx">out2</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kd">interface</span><span class="p">{})</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">defer</span> <span class="nb">close</span><span class="p">(</span><span class="nx">out1</span><span class="p">)</span>
        <span class="k">defer</span> <span class="nb">close</span><span class="p">(</span><span class="nx">out2</span><span class="p">)</span>
        <span class="k">for</span> <span class="nx">val</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">in</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">out1</span><span class="p">,</span> <span class="nx">out2</span> <span class="p">=</span> <span class="nx">out1</span><span class="p">,</span> <span class="nx">out2</span>
            <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
                <span class="k">select</span> <span class="p">{</span>
                <span class="k">case</span> <span class="nx">out1</span><span class="o">&lt;-</span> <span class="nx">val</span><span class="p">:</span>
                    <span class="nx">out1</span> <span class="p">=</span> <span class="kc">nil</span>
                <span class="k">case</span> <span class="nx">out2</span><span class="o">&lt;-</span> <span class="nx">val</span><span class="p">:</span>
                    <span class="nx">out2</span> <span class="p">=</span> <span class="kc">nil</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}()</span>
    <span class="k">return</span> <span class="nx">out1</span><span class="p">,</span> <span class="nx">out2</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p>vs Mutex Implementation</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// NOTE: For this implementation, we will use closures to avoid dealing with raw memory
</span><span class="c1"></span><span class="nx">tee</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">in</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="kd">func</span><span class="p">()</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="kt">bool</span><span class="p">),</span> <span class="kd">func</span><span class="p">()</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="kt">bool</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">mu</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">Sync</span><span class="p">.</span><span class="nx">Mutex</span><span class="p">{}</span>
    <span class="nx">c1</span> <span class="o">:=</span> <span class="nf">NewCond</span><span class="p">(</span><span class="nx">mu</span><span class="p">)</span>
    <span class="nx">c2</span> <span class="o">:=</span> <span class="nf">NewCond</span><span class="p">(</span><span class="nx">mu</span><span class="p">)</span>
    <span class="nx">handle1_status</span> <span class="o">:=</span> <span class="kc">false</span>
    <span class="nx">handle2_status</span> <span class="o">:=</span> <span class="kc">false</span>
    <span class="kd">var</span> <span class="nx">val</span> <span class="kt">int</span>
    <span class="kd">var</span> <span class="nx">done</span> <span class="kt">bool</span>

    <span class="nx">handle1</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">(){</span>
        <span class="nx">mu</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
        <span class="k">defer</span> <span class="nx">mu</span><span class="p">.</span><span class="nf">UnLock</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">done</span><span class="p">){</span><span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nx">done</span><span class="p">)}</span>
        <span class="nf">while</span> <span class="p">(</span><span class="nx">handle1_status</span> <span class="o">==</span> <span class="kc">true</span><span class="p">){</span><span class="nx">c1</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()}</span>
        <span class="nx">handle1_status</span> <span class="p">=</span> <span class="kc">true</span>

        <span class="c1">// Case 1: we are first to grab
</span><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nx">handle2_status</span> <span class="o">==</span> <span class="kc">false</span><span class="p">){</span>
            <span class="nx">val</span><span class="p">,</span><span class="nx">done</span> <span class="o">&lt;-</span> <span class="nx">in</span>
            <span class="nx">local_val</span> <span class="p">=</span> <span class="nx">val</span>
            <span class="nx">local_done</span> <span class="p">=</span> <span class="nx">done</span>
            <span class="k">return</span> <span class="nx">local_val</span><span class="p">,</span><span class="nx">local_done</span>
        <span class="p">}</span>
        <span class="c1">// Case 2: other handle has already grabbed. If so, reset
</span><span class="c1"></span>        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">local_val</span> <span class="p">=</span> <span class="nx">val</span><span class="c1">// in case value changes during return
</span><span class="c1"></span>            <span class="nx">local_done</span> <span class="p">=</span> <span class="nx">done</span>
            <span class="nx">handle1_status</span> <span class="p">=</span> <span class="kc">false</span>
            <span class="nx">handle2_status</span> <span class="p">=</span> <span class="kc">false</span>
            <span class="nx">c2</span><span class="p">.</span><span class="nf">signal</span><span class="p">()</span>
            <span class="k">return</span> <span class="nx">local_val</span><span class="p">,</span><span class="nx">local_done</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">handle2</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">(){</span>
        <span class="nx">mu</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
        <span class="k">defer</span> <span class="nx">mu</span><span class="p">.</span><span class="nf">UnLock</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">done</span><span class="p">){</span><span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nx">done</span><span class="p">)}</span>
        <span class="nf">while</span> <span class="p">(</span><span class="nx">handle2_status</span> <span class="o">==</span> <span class="kc">true</span><span class="p">){</span><span class="nx">c2</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()}</span>
        <span class="nx">handle2_status</span> <span class="p">=</span> <span class="kc">true</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">handle1_status</span> <span class="o">==</span> <span class="kc">false</span><span class="p">){</span>
            <span class="nx">val</span> <span class="o">&lt;-</span> <span class="nx">in</span>
            <span class="nx">local_val</span> <span class="p">=</span> <span class="nx">val</span>
            <span class="nx">local_done</span> <span class="p">=</span> <span class="nx">done</span>
            <span class="k">return</span> <span class="nx">local_val</span><span class="p">,</span><span class="nx">local_done</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">local_val</span> <span class="p">=</span> <span class="nx">val</span>
            <span class="nx">local_done</span> <span class="p">=</span> <span class="nx">done</span>
            <span class="nx">handle1_status</span> <span class="p">=</span> <span class="kc">false</span>
            <span class="nx">handle2_status</span> <span class="p">=</span> <span class="kc">false</span>
            <span class="nx">c1</span><span class="p">.</span><span class="nf">signal</span><span class="p">()</span>
            <span class="k">return</span> <span class="nx">local_val</span><span class="p">,</span><span class="nx">local_done</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">handle1</span><span class="p">,</span> <span class="nx">handle2</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p>First, the most striking difference is in the responsibilities of the calling function(<code>value &lt;-out1</code> vs <code>handle1()</code>). The channel implementation is <strong>centralized</strong>, so both <code>out1</code> and <code>out2</code> get routed/delegated to the same goroutine. Once there, the goroutine decides on the next state. In contrast, <code>handle1</code> and <code>handle2</code> each decide by themselves what the next state will be, by &ldquo;peering&rdquo; into the other&rsquo;s state and making a decision based on that. As such, there is a lot of repeat code that differs only in naming of &ldquo;something1&rdquo; vs &ldquo;something2&rdquo;<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></p>
<p>Furthermore, the addition of another agent allows both control flow and state to be preserved between function calls(in other words, properties of a coroutine). The mutex implementation can only communicate to other threads by changing state while holding the lock. But on <strong>each subsequent function call, the &ldquo;code&rdquo; it calls will be the same</strong>. In contrast, the &ldquo;code&rdquo; that gets called during a channel send is dependent on the section of code it last left off at. To sum it up, this means there will be less <code>if</code> dispatches based on state, as the state has been &ldquo;encoded&rdquo; into the control flow.</p>
<p>Another aspect of that the level of indirection buys us is the ability to selectively listen to a channel (by temporarily setting the reference to <code>nil</code>). Whereas with a mutex, everyone has an equal chance to grab the lock, and thus the while-condition variable pattern in the mutex implementation: as sometimes it may not be the right time to grab, but the <strong>handler has no way of knowing that until it comes in, grab the lock, and inspect state</strong>.</p>
<p>Finally, the local variables in the mutex implementation mostly stems from the lack of encapsulation: When you send a value along a channel, you are making a copy of the value too.</p>
<h2 id="consequence-of-indirection"><!-- raw HTML omitted -->4.2<!-- raw HTML omitted --> Consequence of Indirection</h2>
<p>Consider the following example, where we implement a synchronized object that produces multiples of 3.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// Inside x&#39;s &#34;Constructor&#34;
</span><span class="c1"></span><span class="k">go</span> <span class="kd">func</span><span class="p">(){</span>
<span class="k">for</span><span class="p">{</span>
<span class="o">&lt;-</span> <span class="nx">x</span><span class="p">.</span><span class="nx">request_channel</span>
<span class="nx">x</span><span class="p">.</span><span class="nx">state</span> <span class="o">+=</span> <span class="mi">3</span>
<span class="nx">x</span><span class="p">.</span><span class="nx">receive_channel</span><span class="o">&lt;-</span> <span class="nx">old_state</span>
<span class="p">}</span>
<span class="p">}</span>
<span class="nf">fun</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">IDGenerator</span><span class="p">)</span> <span class="nf">next</span><span class="p">()</span> <span class="kt">int</span><span class="p">{</span>
<span class="nx">x</span><span class="p">.</span><span class="nx">request_channel</span> <span class="o">&lt;-</span> <span class="s">&#34;get next&#34;</span>
<span class="k">return</span> <span class="o">&lt;-</span><span class="nx">x</span><span class="p">.</span><span class="nx">send_channel</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p>vs Mutex Implementation</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">IDGenerator</span><span class="p">)</span> <span class="nf">next</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
<span class="nx">x</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
<span class="k">defer</span> <span class="nx">x</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
<span class="nx">old_state</span> <span class="o">:=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">state</span>
<span class="nx">x</span><span class="p">.</span><span class="nx">state</span> <span class="o">+=</span> <span class="mi">3</span>
<span class="k">return</span> <span class="nx">old_state</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p>Functionally, they are more or less the same, though the channel implementation is a bit wordier from needing a send and receive channel<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>. The main issue with the channel implementation, however, is that it is essentially a memory leak, as the goroutine will live indefinitely. This can be remedied, though it is somewhat tedious, as destructors/&ldquo;done channels&rdquo; in Go have to be explicitly called(just like <code>free</code> in C), compared to C++/Rust where the compiler will generate the call for you.Â <sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>.</p>
<h1 id="final-remarks"><!-- raw HTML omitted -->5<!-- raw HTML omitted --> Final Remarks</h1>
<p>So now that we know about some of the properties of channels, they can hopefully help us make more informed decisions on when to use them. For example, channels are not that great of a choice for broadcasting, as their consumption nature requires us to essentially implement a pub-sub mechanism, and their blocking nature further hinders us from concurrently notifying all listeners/may hang if a listener doesn&rsquo;t respond.</p>
<p>Queues, on the other hand, are consuming and so channels will probably be a better idea for anything that is stream-like. Furthermore, channels are first class citizens when it comes to for loop termination and select statement(and in <code>select's</code> case, the only citizen).</p>
<p>Finally, through their ability to preserve control flow, channels allow us to better express complex synchronization requirements. But with all that said, unless your situation is very stream-like, I personally would suggest using a mutex initially. That is because mutexes allow you to do any type of operation on the state, whereas you would need to create a new channel to put in the <code>select</code> statement of the &ldquo;centralized&rdquo; goroutine. So instead of one blocking mutex, you wil have 2-4 blocking channels or will need to typecast from <code>interface{}</code>. Additonally, mutexes can &ldquo;compose&rdquo; with each other, in the sense of being to atomically change more than one thing at a time. One however, cannot &ldquo;grab&rdquo; two channels at the same time, and so the only solution is to create a channel that manages both resources. Do this a couple times, and you will eventually end up with &ldquo;god&rdquo; channel/goroutine that will be a source of hidden dependencies + concurrency slowdown.  Last but not least, I just find channels sometimes lacking in their ability to  &ldquo;express intent&rdquo; that a mutex or condition variable gives. When reading the type signature <code>chan int</code>, how can I tell if it is being used as a future, mutex, or just data transport? In these situations, <strong>it is the channel that is &ldquo;low level&rdquo;, not the mutex</strong>!</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>Quotations as technically we are not trying to grab another lock while in possession of one, but rather we default block/sleep until someone &ldquo;signals&rdquo; us&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>Alternatives formulations would be to call a closure that generates a closure twice or array style, both of which would require us to program in the general case rather than just 2 tees, which means we have to do additional case analysis. So to keep things simple and to follow Go style, I chose to copy paste in this particular situation.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3" role="doc-endnote">
<p>As otherwise, values will be precomputed, which may or may not be desirable&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4" role="doc-endnote">
<p>if you have defined a destructor/Drop trait&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>


        
          <div class="blog-tags">
            
              <a href="https://bbli.github.io/tags/go/">go</a>&nbsp;
            
              <a href="https://bbli.github.io/tags/software-design/">software-design</a>&nbsp;
            
          </div>
        

        
            <hr/>
            <section id="social-share">
              <div class="list-inline footer-links">
                

<div class="share-box" aria-hidden="true">
    <ul class="share">
      
      <li>
        <a href="//twitter.com/share?url=https%3a%2f%2fbbli.github.io%2fposts%2fgo_channel_properties%2f&amp;text=Properties%20of%20Go%20Channels&amp;via=" target="_blank" title="Share on Twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fbbli.github.io%2fposts%2fgo_channel_properties%2f" target="_blank" title="Share on Facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//reddit.com/submit?url=https%3a%2f%2fbbli.github.io%2fposts%2fgo_channel_properties%2f&amp;title=Properties%20of%20Go%20Channels" target="_blank" title="Share on Reddit">
          <i class="fab fa-reddit"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fbbli.github.io%2fposts%2fgo_channel_properties%2f&amp;title=Properties%20of%20Go%20Channels" target="_blank" title="Share on LinkedIn">
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fbbli.github.io%2fposts%2fgo_channel_properties%2f&amp;title=Properties%20of%20Go%20Channels" target="_blank" title="Share on StumbleUpon">
          <i class="fab fa-stumbleupon"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fbbli.github.io%2fposts%2fgo_channel_properties%2f&amp;description=Properties%20of%20Go%20Channels" target="_blank" title="Share on Pinterest">
          <i class="fab fa-pinterest"></i>
        </a>
      </li>
    </ul>
  </div>
  

              </div>
            </section>
        

        
          
            
          

          
                  <h4 class="see-also">See also</h4>
                  <ul>
                
                
                    <li><a href="/posts/crtp_with_object_model/">Clarifying CRTP with the C&#43;&#43; object model</a></li>
                
              </ul>

          
        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://bbli.github.io/posts/crtp_with_object_model/" data-toggle="tooltip" data-placement="top" title="Clarifying CRTP with the C&#43;&#43; object model">&larr; Previous Post</a>
            </li>
          
          
        </ul>
      


      
        
        
      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:bbl2117@columbia.edu" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/bbli" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://linkedin.com/in/bensonbinbinli" title="LinkedIn">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">

Powered by <a href="http://gohugo.io">Hugo</a> + <a href="https://ox-hugo.scripter.co/">ox-hugo</a> + <a href="https://github.com/hlissner/doom-emacs" >Emacs</a>
            &nbsp;&bull;&nbsp;
        Slight Adaption of <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> Theme
          
        </p>
        
        
        
        
        
      </div>
    </div>
  </div>
</footer><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="https://bbli.github.io/js/main.js"></script><script> renderMathInElement(document.body); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://bbli.github.io/js/load-photoswipe.js"></script>











    
  </body>
</html>

